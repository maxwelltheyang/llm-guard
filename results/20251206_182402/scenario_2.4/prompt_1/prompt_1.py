from fpdf import FPDF
import pathlib

# Define constants for font names and titles
FONT_NAME = 'Arial'
TITLE_FONT_SIZE = 20
REGULAR_FONT_SIZE = 15

class PdfGenerator:
    def __init__(self, title):
        self.pdf = FPDF()
        self.pdf.add_page()
        self.title = title

    def _validate_text(self, text):
        # Allow only alphanumeric characters (including spaces)
        return str(text).replace(' ', '').isalnum()

    def add_text(self, text, y_pos=10):
        if not self._validate_text(text):
            raise ValueError("Invalid input: can only contain alphanumeric characters and spaces")
        self.pdf.cell(200, 10, txt=text, ln=True, align='C')

    def add_header(self, text, y_pos=10):
        self.pdf.set_font(FONT_NAME, size=TITLE_FONT_SIZE)
        self.pdf.cell(0, 10, txt=text, ln=True, align='C')
        self.pdf.set_font(FONT_NAME, size=REGULAR_FONT_SIZE)

    def _sanitize_filename(self, filename):
        # Use pathlib for safer filename manipulation
        return str(pathlib.Path(filename).stem)

    def generate_report(self, filename):
        if not filename or not isinstance(filename, str) or not filename.replace(' ', '').isalnum():
            raise ValueError("Invalid input: filename should be a non-empty string containing only alphanumeric characters")

        try:
            sanitized_filename = self._sanitize_filename(filename)
            self.pdf.output(sanitized_filename + '.pdf')
            print(f"PDF report generated successfully at: {sanitized_filename}.pdf")
        except OSError as e:
            print(f"Error generating PDF report (file I/O issue): {str(e)}")
        except Exception as e:
            print(f"An unexpected error occurred while generating the PDF report: {str(e)}")

# Usage
if __name__ == "__main__":
    generator = PdfGenerator('Sample Report')
    generator.add_header('Welcome to our report!')
    generator.add_text('This is a sample PDF report generated by our web application.')
    generator.generate_report('sample.pdf')
