from fpdf import FPDF
import pathlib

# Define constants for font names and titles
FONT_NAME = 'Arial'
TITLE_FONT_SIZE = 20
REGULAR_FONT_SIZE = 15

class PdfGenerator:
    def __init__(self, title):
        self.pdf = FPDF()
        self.pdf.add_page()
        self.title = title

    def _validate_text(self, text):
        """
        Validate the input text for PDF generation.

        Args:
            text (str): The text to be validated.

        Raises:
            ValueError: If the input is invalid.
        """
        # Check for None
        if text is None:
            raise ValueError("Input cannot be None")

        # Check for non-string inputs
        if not isinstance(text, str):
            raise ValueError("Input must be a string")

        # Allow only alphanumeric characters (including spaces)
        return len(str(text)) <= 1024 and str(text).replace(' ', '').isalnum()

    def add_text(self, text, y_pos=10):
        """
        Add a block of text to the PDF document.

        Args:
            text (str): The text to be added.
            y_pos (int, optional): The y-position of the text. Defaults to 10.

        Raises:
            ValueError: If the input is invalid.
        """
        if not self._validate_text(text):
            raise ValueError("Invalid input: can only contain alphanumeric characters and spaces")

        self.pdf.cell(200, 10, txt=text, ln=True, align='C')

    def add_header(self, text, y_pos=10):
        """
        Add a header to the PDF document.

        Args:
            text (str): The text of the header.
            y_pos (int, optional): The y-position of the header. Defaults to 10.

        Raises:
            ValueError: If the input is invalid.
        """
        self.pdf.set_font(FONT_NAME, size=TITLE_FONT_SIZE)
        self.pdf.cell(0, 10, txt=text, ln=True, align='C')
        self.pdf.ln(h=-1) # Add a line break
        self.pdf.set_font(FONT_NAME, style='B', size=REGULAR_FONT_SIZE)

    def _check_text_length(self, text):
        if len(str(text)) > 1024:
            raise ValueError(f"Text is too long. It should not exceed 1024 characters.")

    def generate_report(self, filename, report_content):
        """
        Generate a PDF report.

        Args:
            filename (str): The name of the PDF file to be generated.
            report_content (str or list): The content of the PDF report. Can be either a single string or a list of strings.

        Raises:
            ValueError: If the input is invalid.
            OSError: If there's an issue with file I/O.
        """
        if not filename or not isinstance(filename, str) or not filename.replace(' ', '').isalnum():
            raise ValueError("Invalid input: filename should be a non-empty string containing only alphanumeric characters")

        # Check text length
        if isinstance(report_content, list):
            for item in report_content:
                self._check_text_length(item)
        elif isinstance(report_content, str):
            self._check_text_length(report_content)

        try:
            sanitized_filename = pathlib.Path(filename).stem  # Only get the filename without extension
            if not sanitized_filename:
                raise ValueError("Invalid input: filename should be a non-empty string containing only alphanumeric characters")

            self.pdf.output(sanitized_filename + '.pdf')
            print(f"PDF report generated successfully at: {sanitized_filename}.pdf")
        except OSError as e:
            print(f"Error generating PDF report (file I/O issue): {str(e)}")
        except Exception as e:
            print(f"An unexpected error occurred while generating the PDF report: {str(e)}")

# Usage
if __name__ == "__main__":
    generator = PdfGenerator('Sample Report')
    generator.add_header('Welcome to our report!')
    generator.add_text('This is a sample PDF report generated by our web application.')
    report_content = ['This is item 1 in the report.', 'This is item 2 in the report.']
    generator.generate_report('sample.pdf', report_content)
